# 1. Введение

Задача crowd/people counting — определение числа людей в зоне наблюдения и их пространственно-временного распределения — востребована в управлении потоками в зданиях, ритейле, транспорте, при обеспечении безопасности и планировании ресурсов. Классические подходы к подсчёту делятся на детекционные, регрессионные и оценку плотности (density maps). За последние годы точность и устойчивость существенно выросли благодаря глубоким CNN, новым функциям потерь и появлению крупных датасетов (ShanghaiTech, UCF-QNRF, UCSD, др.). Одновременно сохраняются инженерные вызовы: окклюзии, перспектива/масштаб, неравномерная плотность, шумы сцены.

Цель проекта — спроектировать реалистичную для учебной команды систему, которая:

считает IN/OUT через виртуальные линии;

строит тепловые карты траекторий и находит «густые» зоны;

формирует статистику по интервалам времени (мин/час/день);

использует готовые предобученные модели, минимизируя порог входа.

# 2. Функциональные требования

Источники данных: видеофайлы (MP4).

Обработка кадров: дискретизация 6–10 fps; базовый препроцессинг (масштабирование, нормализация).

Детекция людей: выделение bbox класса person с оценкой уверенности.

Трекинг: присвоение устойчивых track_id между кадрами (минимум IoU-ассоциация).

Подсчёт IN/OUT: фиксирование пересечения виртуальной линии с направлением.

Траектории и тепловые карты: накопление центроидов треков; построение 2D-плотности.

Агрегации и отчёты: метрики по интервалам (1/5/15/60 мин), пики посещаемости, экспорт CSV/JSON.

Веб-панель: текущие счётчики, графики, тепловая карта, выбор интервалов/камер.

# 3. Нефункциональные требования
3.1 Производительность

Система должна эффективно работать при обработке видеозаписей различной длины и разрешения.
Основные показатели:

скорость обработки — не менее 5 кадров в секунду при разрешении 1280×720;

время предварительной загрузки видео длительностью до 30 минут — не более 10 секунд;

время генерации отчёта (тепловая карта, статистика) — не более 15 секунд после завершения анализа.
Программа должна стабильно работать при последовательной обработке нескольких видеозаписей без ручного вмешательства.

3.2 Масштабируемость

Архитектура системы должна позволять:

добавление новых видеофайлов в очередь без остановки работы программы;

обработку видео разной длительности и разрешения без изменения кода;

перенос системы на более мощное оборудование или в облачную среду без модификации логики.
Производительность при увеличении объёма данных должна снижаться линейно, без критических задержек.

3.3 Эргономичность

Интерфейс приложения должен быть простым и понятным для пользователя.
Требуется:

удобная загрузка файлов (drag-and-drop или выбор из проводника);

визуальное отображение прогресса обработки;

логичная структура навигации и элементов интерфейса;

наглядная визуализация результатов — графики, тепловые карты, статистика.
Пользователь должен уметь запустить полный цикл анализа без обращения к документации.

3.4 Надёжность

Система должна обеспечивать устойчивую работу при типичных ошибках и сбоях.
Требуется:

сохранение промежуточных результатов при прерывании обработки;

возможность повторного запуска с места остановки;

корректное завершение при повреждённом видеофайле;

отсутствие утечек памяти и зависаний при длительном анализе.
Среднее время безотказной работы должно составлять не менее 24 часов непрерывной эксплуатации.

3.5 Безопасность

Система должна обеспечивать защиту данных пользователей и результатов анализа.
Основные меры:

обработка видео локально, без передачи в сеть;

хранение только числовых и графических результатов (без исходного видео при необходимости приватности);

контроль доступа к сохранённым отчётам;

защита файлов отчётов и базы данных от несанкционированного изменения.
В случае расширения до сетевой версии необходимо предусмотреть шифрование соединений (TLS) и авторизацию пользователей.

# 4. Архитектура приложения

Цель и контекст

Приложение выполняет пакетную постобработку видеозаписей: для каждого файла извлекаются кадры с заданным шагом, на кадрах выполняется детекция людей и вычисляются события пересечения контрольной линии (IN/OUT), траектории и тепловые карты. Результаты сохраняются в БД и/или файлах отчётов.

| **Подход** | **Механизм** | **Преимущества** | **Недостатки** |
| ---        | ---          | ---              | ---            |
| **Detection-based (на основе CNN)** |     Использует свёрточную нейросеть для детекции отдельных людей (например, YOLO, SSD, Faster R-CNN).      |          Высокая точность при умеренной плотности, визуально понятные результаты. |          Снижение точности при сильных перекрытиях или высокой плотности толпы. |
| **Regression-based**   | Извлекает признаки (текстура, площадь, яркость) и оценивает общее число людей с помощью регрессионной модели.     | Простая реализация, быстрое обучение.    |   Теряет пространственную информацию, плохо переносится между сценами. |
| **Density-map-based**    | Генерирует карту плотности (heatmap), где интенсивность соответствует числу людей в области кадра.       | Учитывает распределение и плотность, устойчив к окклюзиям.      | Требует сложной разметки (точки голов), обучение занимает много ресурсов. |
