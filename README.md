# 1. Введение

Задача crowd/people counting — определение числа людей в зоне наблюдения и их пространственно-временного распределения — востребована в управлении потоками в зданиях, ритейле, транспорте, при обеспечении безопасности и планировании ресурсов. Классические подходы к подсчёту делятся на детекционные, регрессионные и оценку плотности (density maps). За последние годы точность и устойчивость существенно выросли благодаря глубоким CNN, новым функциям потерь и появлению крупных датасетов (ShanghaiTech, UCF-QNRF, UCSD, др.). Одновременно сохраняются инженерные вызовы: окклюзии, перспектива/масштаб, неравномерная плотность, шумы сцены.

Цель проекта — спроектировать реалистичную для учебной команды систему, которая:

считает IN/OUT через виртуальные линии;

строит тепловые карты траекторий и находит «густые» зоны;

формирует статистику по интервалам времени (мин/час/день);

использует готовые предобученные модели, минимизируя порог входа.

# 2. Функциональные требования

Источники данных: видеофайлы (MP4).

Обработка кадров: дискретизация 6–10 fps; базовый препроцессинг (масштабирование, нормализация).

Детекция людей: выделение bbox класса person с оценкой уверенности.

Трекинг: присвоение устойчивых track_id между кадрами (минимум IoU-ассоциация).

Подсчёт IN/OUT: фиксирование пересечения виртуальной линии с направлением.

Траектории и тепловые карты: накопление центроидов треков; построение 2D-плотности.

Агрегации и отчёты: метрики по интервалам (1/5/15/60 мин), пики посещаемости, экспорт CSV/JSON.

Веб-панель: текущие счётчики, графики, тепловая карта, выбор интервалов/камер.

# 3. Нефункциональные требования
3.1 Производительность

Система должна эффективно работать при обработке видеозаписей различной длины и разрешения.
Основные показатели:

скорость обработки — не менее 5 кадров в секунду при разрешении 1280×720;

время предварительной загрузки видео длительностью до 30 минут — не более 10 секунд;

время генерации отчёта (тепловая карта, статистика) — не более 15 секунд после завершения анализа.
Программа должна стабильно работать при последовательной обработке нескольких видеозаписей без ручного вмешательства.

3.2 Масштабируемость

Архитектура системы должна позволять:

добавление новых видеофайлов в очередь без остановки работы программы;

обработку видео разной длительности и разрешения без изменения кода;

перенос системы на более мощное оборудование или в облачную среду без модификации логики.
Производительность при увеличении объёма данных должна снижаться линейно, без критических задержек.

3.3 Эргономичность

Интерфейс приложения должен быть простым и понятным для пользователя.
Требуется:

удобная загрузка файлов (drag-and-drop или выбор из проводника);

визуальное отображение прогресса обработки;

логичная структура навигации и элементов интерфейса;

наглядная визуализация результатов — графики, тепловые карты, статистика.
Пользователь должен уметь запустить полный цикл анализа без обращения к документации.

3.4 Надёжность

Система должна обеспечивать устойчивую работу при типичных ошибках и сбоях.
Требуется:

сохранение промежуточных результатов при прерывании обработки;

возможность повторного запуска с места остановки;

корректное завершение при повреждённом видеофайле;

отсутствие утечек памяти и зависаний при длительном анализе.
Среднее время безотказной работы должно составлять не менее 24 часов непрерывной эксплуатации.

3.5 Безопасность

Система должна обеспечивать защиту данных пользователей и результатов анализа.
Основные меры:

обработка видео локально, без передачи в сеть;

хранение только числовых и графических результатов (без исходного видео при необходимости приватности);

контроль доступа к сохранённым отчётам;

защита файлов отчётов и базы данных от несанкционированного изменения.
В случае расширения до сетевой версии необходимо предусмотреть шифрование соединений (TLS) и авторизацию пользователей.

# 4. Архитектура приложения

Цель и контекст

Приложение выполняет пакетную постобработку видеозаписей: для каждого файла извлекаются кадры с заданным шагом, на кадрах выполняется детекция людей и вычисляются события пересечения контрольной линии (IN/OUT), траектории и тепловые карты. Результаты сохраняются в БД и/или файлах отчётов.

### 1. Общее сравнение подходов

| **Подход** | **Механизм** | **Преимущества** | **Недостатки** |
| ---        | ---          | ---              | ---            |
| **Detection-based (на основе CNN)** |     Использует свёрточную нейросеть для детекции отдельных людей (например, YOLO, SSD, Faster R-CNN).      |          Высокая точность при умеренной плотности, визуально понятные результаты. |          Снижение точности при сильных перекрытиях или высокой плотности толпы. |
| **Regression-based**   | Извлекает признаки (текстура, площадь, яркость) и оценивает общее число людей с помощью регрессионной модели.     | Простая реализация, быстрое обучение.    |   Теряет пространственную информацию, плохо переносится между сценами. |
| **Density-map-based**    | Генерирует карту плотности (heatmap), где интенсивность соответствует числу людей в области кадра.       | Учитывает распределение и плотность, устойчив к окклюзиям.      | Требует сложной разметки (точки голов), обучение занимает много ресурсов. |

Из этих трёх подходов именно **детекционные методы на основе свёрточных нейронных сетей (CNN)** сегодня считаются **наиболее универсальными и интерпретируемыми**.
Это подтверждается в ряде публикаций (например, Akshita Patwal et al., 2023), где указано, что детекционные CNN-модели (YOLO, Faster R-CNN, SSD) обеспечивают **высокую точность на сценах с умеренной плотностью**, что делает их оптимальными для инженерных прототипов и прикладных решений.

### 2. Объективные преимущества детекционного CNN-подхода

| Критерий | Detection-based (YOLO, SSD) | Density-map (SRNet, CRNet и др.) | Regression-based |
|:---|:---|:---|:---|
| **Интерпретируемость** | Каждый человек визуализируется рамкой, легко проверить результат | Результат — плотность, без точных позиций | Даёт только число, без визуальной валидации |
| **Необходимость обучения** | Можно использовать предобученные модели (COCO, CrowdHuman) | Требуется обучение на размеченных картах плотности | Требует обучающего набора с конкретной сценой |
| **Требования к вычислительным ресурсам** | Умеренные — работает на CPU | Очень высокие (GPU + большие батчи) | Низкие, но низкая точность |
| **Точность на разреженных сценах** | Высокая (Precision > 0.9) | Снижается из-за усреднения плотности | Средняя |
| **Применимость в инженерных задачах** | Подходит для прототипов и систем видеонаблюдения | Чаще используется в научных экспериментах | Ограничена |
| **Устойчивость к изменению сцены** | Хорошая — CNN видит контекст | Низкая, требует адаптации | Плохо переносится между сценами |

### 3. Практическая применимость YOLO

Модель **YOLO (You Only Look Once)** представляет собой **универсальный CNN-детектор**, который объединяет высокую скорость и точность.  
Согласно открытым бенчмаркам:
- **YOLOv5 / YOLOv8** достигает *mAP (mean average precision)* 0.5–0.7 на наборе COCO при скорости более **100 FPS на GPU** и **8–12 FPS на CPU**.
- При применении к задаче подсчёта людей YOLO стабильно выделяет объекты даже в кадрах средней плотности (до 30 человек) без дообучения.

YOLO используется в реальных системах:
- **Crowd Counting Toolkit (OpenCV AI)** — детекция людей с помощью YOLO;
- **Smart Retail Analytics (Intel)** — анализ посетителей магазинов;
- **Transportation Flow Analysis (NVIDIA DeepStream)** — анализ трафика.

Таким образом, YOLO доказала эффективность **в практических инженерных приложениях**, а не только в академических тестах.

---

### 4. Соответствие возможностям проекта

| Ограничение учебного проекта | Реакция детекционного подхода |
|:---|:---|
| Нет GPU / ограниченные ресурсы | Лёгкие варианты YOLO (v5n, v8n) работают на CPU с приемлемой скоростью (5–10 кадров/с). |
| Нет размеченного датасета | Можно использовать предобученные веса на COCO без дополнительного обучения. |
| Требуется визуальная проверка результатов | YOLO визуализирует каждого человека, что упрощает отладку. |
| Нужно получить тепловые карты и статистику | Детектор даёт координаты, которые легко преобразовать в плотностную карту. |
| Ограниченное время на реализацию | Интеграция YOLO через библиотеку `ultralytics` или `torchvision` занимает < 100 строк кода. |

---

### 5. Научное обоснование выбора

В обзоре (*Patwal et al., 2023*) показано, что **детекционные CNN-подходы** сохраняют лидирующие позиции по точности и устойчивости для низко- и среднеплотных сцен.

- **Detection-based methods** имеют высокую точность для разреженных толп и минимальные вычислительные требования.  
- **Density estimation**-методы лучше работают в сверхплотных сценах, но требуют значительных ресурсов.  
- Обучение таких моделей требует тысяч размеченных изображений и GPU, что нецелесообразно для лабораторного проекта.

Таким образом, выбор **Detection-based CNN (YOLO)** объективно обоснован:  
он сочетает **современные технологии глубокого обучения**, **высокую точность**, **простоту внедрения** и **доказанную практическую эффективность**.

---

💡 **Вывод:**  
Детекционный подход на основе свёрточных нейронных сетей — оптимальное решение для задачи подсчёта посетителей и анализа трафика.  
Он сочетает:
- научную обоснованность (подтверждено в обзорах и бенчмарках);
- инженерную реализуемость в учебных условиях;
- достаточную точность и интерпретируемость результатов.

Поэтому ядром интеллектуальной системы выбрана модель **YOLO**, выполняющая обнаружение и отслеживание людей на кадрах видеозаписи.
